<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ì˜ë¦¬ì‚¬ì—…ë¶€ ë°ì´í„°ë² ì´ìŠ¤</title>
    <!-- BOOTSTRAP STYLES -->
    <link href="assets/css/bootstrap.css" rel="stylesheet" />
    <!-- FONTAWESOME STYLES -->
    <link href="assets/css/font-awesome.css" rel="stylesheet" />
    <!-- CUSTOM STYLES -->
    <link href="assets/css/custom.css" rel="stylesheet" />
    <!-- GOOGLE FONTS -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" />
    <script src="https://kit.fontawesome.com/b97fd141c7.js" crossorigin="anonymous"></script>
</head>
<body>

<div id="wrapper">
    <div class="navbar navbar-inverse navbar-fixed-top">
        <div class="adjust-nav">
            <div class="navbar-header">
                <a class="navbar-brand" href="#"><img src="https://i.imgur.com/LeXEsL5.png" /></a>
            </div>
                <span class="empty" >

                </span>
        </div>
    </div>

    <nav class="navbar-default navbar-side" role="navigation">
        <div class="sidebar-collapse">
            <ul class="nav" id="main-menu">
                <li><a href="index.html"><i class="fa fa-desktop"></i>ë©”ì¸ ëŒ€ì‹œë³´ë“œ<span class="badge">ìˆ˜ì •ì¤‘</span></a></li>
                <li class="active-link"><a href="ui.html"><i class="fa fa-user-plus"></i>DB ì¶”ê°€<span class="badge">ìˆ˜ì •ì¤‘</span></a></li>
                <li><a href="db_list.html"><i class="fa fa-table"></i>DB ëª©ë¡<span class="badge">ìˆ˜ì •ì¤‘</span></a></li>
<li>
    <a href="https://www.naver.com" target="_db_list">
        <i class="fa-solid fa-square-n"></i>ë„¤ì´ë²„ ë°”ë¡œê°€ê¸°
    </a>
</li>
<li>
    <a href="https://www.chatgpt.com" target="_db_list">
        <i class="fa-solid fa-graduation-cap"></i>ì±—GPT ë°”ë¡œê°€ê¸°
    </a>
</li>

                    <li>
                        <a href="#"><i class="fa-solid fa-star"></i>ë§í¬3 ë°”ë¡œê°€ê¸° </a>
                    </li>
                    <li>
                        <a href="#"><i class="fa-solid fa-star"></i>ë§í¬4 ë°”ë¡œê°€ê¸°</a>
                    </li>
                     <li>
                        <a href="#"><i class="fa-solid fa-star"></i>ë§í¬5 ë°”ë¡œê°€ê¸° </a>
                    </li>
            </ul>
        </div>
    </nav>

    <!-- ë©”ì¸ ì»¨í…ì¸  ì˜ì—­ -->
    <div id="page-wrapper">
        <div id="page-inner">
            <div class="row">
                <div class="col-md-12">
                    <h2>DB ì¶”ê°€</h2>
                </div>
            </div>
            <hr />

            <div class="row">
                <div class="col-lg-6">
                    <h5>í•„ìˆ˜ ì¸ì ì‚¬í•­</h5>

                    <div class="input-group">
                        <span class="input-group-addon"><i class="fa fa-user"></i></span>
                        <input type="text" id="name" class="form-control" placeholder="ì´ë¦„ ì…ë ¥" />
                    </div>
                    <br />

                    <div class="input-group">
                        <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                        <input type="text" id="birth" class="form-control" placeholder="ìƒë…„ì›”ì¼ 8ìë¦¬" />
                        <span class="input-group-addon"><i class="fa fa-phone"></i></span>
                        <input type="text" id="phone" class="form-control" placeholder="íœ´ëŒ€ì „í™”ë²ˆí˜¸" />
                    </div>
                    <br />

                    <div class="input-group">
                        <span class="input-group-addon"><i class="fa fa-home"></i></span>
                        <input type="text" id="address" class="form-control" placeholder="ì£¼ì†Œ ì…ë ¥" />
                    </div>
                    <br />

                    <div class="input-group">
                        <span class="input-group-addon"><i class="fa fa-sticky-note"></i></span>
                        <input type="text" id="note" class="form-control" placeholder="íŠ¹ì´ì‚¬í•­ ì…ë ¥" />
                    </div>
                    <br />

                    <button class="btn btn-success btn-lg btn-block" onclick="addUser()">ì¶”ê°€í•˜ê¸°</button>
                </div>

                <div class="col-lg-6">
                    <h5>ì €ì¥ëœ ë°ì´í„°</h5>
                    <ul id="userList" class="list-group"></ul>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- í•˜ë‹¨ í‘¸í„° -->
<div class="footer">
    <div class="row">
        <div class="col-lg-12">
            &copy; 2025 ì˜ë¦¬ì‚¬ì—…ë¶€ ë°ì´í„°ë² ì´ìŠ¤ | ì œì‘ì : ê¹€íƒœê²½
        </div>
    </div>
</div>

<!-- JavaScript (GitHub API ì—°ë™) -->
<script>
const TOKEN = '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';

async function addUser() {
    const name = document.getElementById("name").value;
    const birth = document.getElementById("birth").value;
    const phone = document.getElementById("phone").value;
    const address = document.getElementById("address").value;
    const note = document.getElementById("note").value;

    if (!name || !birth || !phone || !address) {
        alert("ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”!");
        return;
    }

    try {
        // âœ… GitHub APIì—ì„œ data.json ê°€ì ¸ì˜¤ê¸°
        const response = await fetch(`https://api.github.com/repos/loyalty-tg/database/contents/data.json`, {
            headers: { "Authorization": `token ${TOKEN}` }
        });

        if (!response.ok) {
            console.error("âŒ GitHub API ì‘ë‹µ ì˜¤ë¥˜:", await response.text());
            throw new Error("GitHubì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
        }

        const fileData = await response.json();
        const sha = fileData.sha;
        const jsonData = JSON.parse(atob(fileData.content));

        jsonData.users.push({ name, birth, phone, address, note });

        // âœ… í•œê¸€ ê¹¨ì§ ë°©ì§€ (Base64 ì¸ì½”ë”© ë°©ì‹ ìˆ˜ì •)
        const encodedContent = btoa(unescape(encodeURIComponent(JSON.stringify(jsonData, null, 2))));

        // âœ… ë³€ê²½ëœ ë°ì´í„°ë¥¼ GitHub APIë¥¼ í†µí•´ ì—…ë°ì´íŠ¸
        const updateResponse = await fetch(`https://api.github.com/repos/loyalty-tg/database/contents/data.json`, {
            method: "PUT",
            headers: { 
                "Authorization": `token ${TOKEN}`,
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                message: "ì‚¬ìš©ì ì¶”ê°€",
                content: encodedContent,  // âœ… ì˜¬ë°”ë¥´ê²Œ ì¸ì½”ë”©ëœ ë°ì´í„°
                sha: sha
            })
        });

        if (!updateResponse.ok) {
            console.error("âŒ GitHub ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:", await updateResponse.text());
            throw new Error("GitHub ì—…ë°ì´íŠ¸ ì‹¤íŒ¨");
        }

        alert("âœ… ë°ì´í„°ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!");
        window.location.href = "db_list.html"; // âœ… ì¶”ê°€ í›„ ëª©ë¡ í˜ì´ì§€ë¡œ ì´ë™
    } catch (error) {
        console.error("ğŸ”¥ ë°ì´í„° ì¶”ê°€ ì˜¤ë¥˜:", error);
        alert("âŒ ë°ì´í„° ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ ë°œìƒ");
    }
}


async function updateGitHubFile(jsonData, sha, commitMessage) {
    const encodedContent = btoa(unescape(encodeURIComponent(JSON.stringify(jsonData, null, 2)))); // âœ… í•œê¸€ ê¹¨ì§ ë°©ì§€

    await fetch(`https://api.github.com/repos/loyalty-tg/database/contents/data.json`, {
        method: "PUT",
        headers: {
            "Authorization": `token ${TOKEN}`,
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            message: commitMessage,
            content: encodedContent, 
            sha: sha
        })
    });
}



</script>

</body>
</html>
